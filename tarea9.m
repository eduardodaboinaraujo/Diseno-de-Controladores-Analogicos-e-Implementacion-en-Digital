clc 
clear all

%----------------------------------------------------------Respuesta a la pregunta 2 -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
K=1;
% ---- Planta a Controlar ---%
num=[1 1];
den=[1 8 5];
G=tf(num,den);
% ---- Tiempo de muestreo ------%
Frmx=bandwidth(G);
T=5*Frmx;
To=1/T;
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
% ---- Tiempo de asentamiento en lazo abierta ---- % 
r=roots([den(1,1) den(1,2) den(1,3)]);
TsLa=(2.865/abs(r(2)))
% ---- Un tercio del tiempo de asentamiento en lazo abierta ---- % 
TsLat=(2.865/abs(r(2)))/3
% ---- Tiempo de asentamiento menor al de un tercio del sistema en lazo abierto ---- % 
Ts=(2.865/abs(r(2)))/4
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
% ---- Sobredisparo menor del 10% ----- %
Mp=9;
sita=sqrt(log(Mp/100)^2/(pi^2+log(Mp/100)^2))
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
% ----- Frecuencia natural ---- %
Wn = 4/(sita*Ts)
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%---- Controlador Tipo PID ----%
numc=K*Wn^2;
denc=[1 2*Wn*sita Wn^2];
Gc=tf(numc,denc)

raices=roots([denc(1,1) denc(1,2) denc(1,3)]);
P=abs(10*(real(raices(1))));
P3=[1 P];
Pc=conv(denc,P3);

Kc=(Pc(1,3)-den(1,3))/K;
Ti=(K*Kc)/Pc(1,4);
Td=(Pc(1,2)-den(1,2))/(K*Kc);

numcf=[Kc*Td*Ti Kc*Ti Kc/Ti];
dencf=[1 0];
Gcf=tf(numcf,dencf);

SysC=feedback(Gcf*G,1);

%------ Discretizacion por metodo tustin----- %
Gz=tf([0.03974 0.004125 -0.03561],[1 -1.356 0.3972],To);
Gcfz=tf([302.5 -135 161.3],[1 0 -1],To);
GzSysC=tf([0.9232 -1.239 0.8614 -0.4412],[1 -1.42 0.996 -0.4717],To);

figure(1)
step(SysC)
title('Sistema controlado metodo asignacion de polos');
grid on

figure(2)
step(GzSysC)
title('Sistema controlado metodo asignacion de polos discretizado');
grid on
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%----------------------------------------------------------Respuesta a la pregunta 3 -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
Kp=11.5/2;
Ki=205/3;
Kd=0.01/3;

numtae=[Kd Kp Ki];
dentae=[1 0];
Gctae=tf(numtae,dentae);

SysCtae=feedback(Gctae*G,1);

% ------ Discretizacion por metodo tustin----- %
Gzctae=tf([9.551 7.359 -1.949],[1 0 -1],To);
GzSysCtae=tf([0.2751 -0.03459 -0.2461 0.0503],[1 -1.742 1.025 -0.2376],To);

figure(3)
step(SysCtae)
title('Sistema controlado metodo Try AND Error');
grid on

figure(4)
step(GzSysCtae)
title('Sistema controlado metodo Try AND Error discretizado');
grid on
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%----------------------------------------------------------Respuesta a la pregunta 4 -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
figure(5)
step(SysC)
hold on
step(SysCtae,'g')
hold on
step(GzSysC,'r')
hold on
step(GzSysCtae,'k')
title('Sistema controlado continuos y discretizados');
legend('continuo Asignacion de polos','continuo try and error','discreto Asignacion de polos','discreto try and error');
grid on
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%----------------------------------------------------------Respuesta a la pregunta 5 -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
numz=[1.5];
denn=[1 4 5.25 2.75 0.5];
Gzn=tf(numz,denn);

% ---- Tiempo de muestreo ------%
Frmx=bandwidth(Gzn);
T=5*Frmx;
Tozn=1/T;

%----- Sistema en lazo cerrado -----%
GznLc=feedback(Gzn,1);

K=3;
L=1.66;
T=6.63;

numcz=[0.3*T*L^2 0.6*T*L 0.3*T];
dencn=[K*L^2 0];
Gczn=tf(numcz,dencn);

SysCzn=feedback(Gczn*Gzn,1);

Gzczn=tf([0.03391 0.04223 -0.0874 0.02081 0.005758],[1 -3.092 3.82 -2.299 0.6502 -0.06473],Tozn);

figure(6)
step(Gzn)
title('Sistema en lazo abierto');
grid on
figure(7)
step(GznLc)
title('Sistema en lazo cerrado');
grid on

figure(8)
rlocus(Gzn)
title('Ubicacion de polos y ceros en lazo abierto');
grid on
figure(9)
rlocus(GznLc)
title('Ubicacion de polos y ceros en lazo cerrado');
grid on

figure(9)
step(Gzczn)
grid on
